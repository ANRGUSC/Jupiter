- hosts: all
  order: sorted
  gather_facts: False
  become: yes
  tasks:
    - name: Run apt-get update
      apt:
      update_cache: yes

    - name: Install requirements/dependencies
      apt:
        name: "{{packages}}"
        state: present
        update_cache: yes
      vars:
        -apt-transport-https
        -ca-certificates
        -curl
        -gnupg
        -gnupg2
        -software-properties-common

    - name: Install docker.io
      apt:
              name: docker.io
              state: present

    - name: Add Docker APT GPG key
      apt_key:
        url: https://download.docker.com/linux/debian/gpg

    - name: Add Docker APT repository
      apt_repository:
        repo: deb https://download.docker.com/linux/debian buster stable
        state: present

    - name: Update apt and install docker-ce
      apt: update_cache=yes name=docker-ce state=latest

    - name: Add Kubernetes APT GPG key
      apt_key:
        url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
        state: present
    
    - name: Add APT repository for kubernetes 
      apt_repository:
        repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
        state: present
        filename: 'kubernetes'

    - name: Run apt-get update
      apt:
        update_cache: yes

    - name: Install kubectl
      apt: 
        name: kubectl=1.14.0-00
        state: present
   
    - name: Install kubelet
      apt: 
        name: kubelet=1.14.0-00
        state: present

    - name: Install kubeadm
      apt: 
        name: kubeadm=1.14.0-00
        state: present

    - name: Disable swap
      shell: swapoff -a

    - name: Enable and check kubelet service
      systemd:
        name: kubelet
        daemon_reload: yes
        state: started
        enabled: yes

    - name: Enable and check docker service
      systemd:
        name: docker
        daemon_reload: yes
        state: started
        enabled: yes
